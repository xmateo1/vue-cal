(("undefined"!==typeof self?self:this)["webpackJsonpvuecal"]=("undefined"!==typeof self?self:this)["webpackJsonpvuecal"]||[]).push([[37],{7051:function(e,t,n){"use strict";n.r(t),n.d(t,"DragAndDrop",(function(){return p}));n("4de4"),n("7db0"),n("caad"),n("ac1f"),n("2532"),n("1276");var a=n("5530");n("a4d3"),n("c975"),n("b64b");function i(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}function l(e,t){if(null==e)return{};var n,a,l=i(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var r,u=n("d4ec"),c=n("bee2"),s=n("ade3"),v=800,o=null,d=null,h={id:null,date:null},g=!1,f=!0,_={el:null,cell:null,timeout:null},m={_eid:null,fromVueCal:null,toVueCal:null},p=(r=function(){function e(t){Object(u["a"])(this,e),Object(s["a"])(this,"_vuecal",void 0),this._vuecal=t}return Object(c["a"])(e,[{key:"_getEventStart",value:function(e){var t=this._vuecal,n=t.timeStep,a=t.timeCellHeight,i=t.timeFrom,l=t.utils,r=l.cell.getPosition(e),u=r.y;return u-=1*e.dataTransfer.getData("cursor-grab-at"),Math.round(u*n/parseInt(a)+i)}},{key:"_updateEventStartEnd",value:function(e,t,n,a){var i=1*n.duration||t.endTimeMinutes-t.startTimeMinutes,l=Math.max(this._getEventStart(e),0);if(this._vuecal.snapToTime){var r=l+this._vuecal.snapToTime/2;l=r-r%this._vuecal.snapToTime}t.startTimeMinutes=l,t.start=new Date(new Date(a).setMinutes(l)),t.endTimeMinutes=Math.min(l+i,1440),t.end=new Date(new Date(a).setMinutes(t.endTimeMinutes))}},{key:"eventDragStart",value:function(e,t){if(3===e.target.nodeType)return e.preventDefault();e.dataTransfer.dropEffect="move",e.dataTransfer.setData("event",JSON.stringify(t)),e.dataTransfer.setData("cursor-grab-at",e.offsetY);var n=this._vuecal.domEvents.clickHoldAnEvent;setTimeout((function(){n._eid=null,clearTimeout(n.timeoutId),t.deleting=!1}),0),this._vuecal.domEvents.dragAnEvent._eid=t._eid,m._eid=t._eid,m.fromVueCal=this._vuecal._uid,t.dragging=!0,setTimeout((function(){return t.draggingStatic=!0}),0),g=!1,h={id:this._vuecal.view.id,date:this._vuecal.view.startDate},f=!0}},{key:"eventDragEnd",value:function(e){this._vuecal.domEvents.dragAnEvent._eid=null,m._eid=null,e.dragging=!1,e.draggingStatic=!1;var t=m.fromVueCal,n=m.toVueCal;n&&t!==n&&this._vuecal.utils.event.deleteAnEvent(e),m.fromVueCal=null,m.toVueCal=null,g&&f&&h.id&&this._vuecal.switchView(h.id,h.date,!0)}},{key:"cellDragEnter",value:function(e,t,n){var a=this,i=e.currentTarget;if(!e.currentTarget.contains(e.relatedTarget)){if(i===_.el||!i.className.includes("vuecal__cell-content"))return!1;_.el&&(_.cell.highlighted=!1),_={el:i,cell:t,timeout:clearTimeout(_.timeout)},t.highlighted=!0,["years","year","month"].includes(this._vuecal.view.id)&&(_.timeout=setTimeout((function(){return a._vuecal.switchToNarrowerView(n)}),2e3))}}},{key:"cellDragOver",value:function(e,t,n,a){e.preventDefault(),t.highlighted=!0,(a||0===a)&&(t.highlightedSplit=a)}},{key:"cellDragLeave",value:function(e,t){e.preventDefault(),e.currentTarget.contains(e.relatedTarget)||(t.highlightedSplit=!1,_.cell===t&&(clearTimeout(_.timeout),_={el:null,cell:null,timeout:null},t.highlighted=!1))}},{key:"cellDragDrop",value:function(e,t,n,i){var r=this;e.preventDefault(),clearTimeout(_.timeout),_={el:null,cell:null,timeout:null};var u,c,s=JSON.parse(e.dataTransfer.getData("event")||"{}");if(m.fromVueCal!==this._vuecal._uid){s._eid,s.start,s.end;var v=s.duration,o=l(s,["_eid","start","end","duration"]);u=this._vuecal.utils.event.createAnEvent(n,v,Object(a["a"])({},o,{split:i}))}else if(u=this._vuecal.view.events.find((function(e){return e._eid===m._eid})),u||(u=this._vuecal.mutableEvents.find((function(e){return e._eid===m._eid})),c=!!u),!u){var d=s.endTimeMinutes-s.startTimeMinutes,h=(s.start,s.end,l(s,["start","end"]));u=this._vuecal.utils.event.createAnEvent(n,d,Object(a["a"])({},h,{split:i}))}var g=u,p=g.start,T=g.split;this._updateEventStartEnd(e,u,s,n),c&&this._vuecal.addEventsToView([u]),u.dragging=!1,(i||0===i)&&(u.split=i),t.highlighted=!1,t.highlightedSplit=null,f=!1,m.toVueCal=this._vuecal._uid;var w=Object(a["a"])({event:this._vuecal.cleanupEvent(u),oldDate:p,newDate:u.start},(i||0===i)&&{oldSplit:T,newSplit:i},{originalEvent:this._vuecal.cleanupEvent(s),external:!m.fromVueCal});this._vuecal.$emit("event-drop",w),this._vuecal.$emit("event-change",{event:w.event,originalEvent:w.originalEvent}),setTimeout((function(){m._eid&&r.eventDragEnd(u)}),300)}},{key:"viewSelectorDragEnter",value:function(e,t,n){var a=this;e.currentTarget.contains(e.relatedTarget)||(n.highlightedControl=t,clearTimeout(o),o=setTimeout((function(){if(["previous","next"].includes(t))a._vuecal[t](),clearInterval(d),d=setInterval(a._vuecal[t],v);else if("today"===t){var e;clearInterval(d),a._vuecal.view.id.includes("year")&&(e=a._vuecal.enabledViews.filter((function(e){return!e.includes("year")}))[0]),a._vuecal.switchView(e||a._vuecal.view.id,new Date((new Date).setHours(0,0,0,0)),!0)}else a._vuecal.switchView(t,null,!0);g=!0}),v))}},{key:"viewSelectorDragLeave",value:function(e,t,n){e.currentTarget.contains(e.relatedTarget)||n.highlightedControl===t&&(n.highlightedControl=null,o&&(o=clearTimeout(o)),d&&(d=clearInterval(d)))}}]),e}(),r)}}]);